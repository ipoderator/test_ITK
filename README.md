# Items REST API

Простое REST API на FastAPI для управления элементами (Items) с полным набором CRUD операций.

## Описание

Простое REST API для управления элементами (Items) с использованием:
- **FastAPI** - современный веб-фреймворк для создания API
- **Pydantic** - валидация данных и схемы
- **PostgreSQL** - реляционная база данных для хранения данных
- **SQLAlchemy** - ORM для работы с базой данных

## Структура проекта

```
.
├── main.py                          # Основной файл с FastAPI приложением и эндпоинтами
├── schemas.py                       # Pydantic схемы для валидации данных
├── storage.py                       # Функции CRUD для работы с PostgreSQL
├── database.py                      # Настройки подключения к PostgreSQL и модели SQLAlchemy
├── requirements.txt                 # Зависимости проекта
├── Dockerfile                       # Docker образ для запуска приложения
├── docker-compose.yml               # Docker Compose конфигурация
├── .gitignore                       # Git ignore правила
├── .dockerignore                    # Docker ignore правила
├── README.md                        # Документация проекта
└── postman/                         # Postman коллекции для тестирования
    └── Items_API.postman_collection.json
```

## Эндпоинты API

### Health Check эндпоинты

#### GET /health
Проверка работоспособности API. Используется для мониторинга состояния сервиса.

**Ответ:** `200 OK`
```json
{
  "status": "healthy",
  "service": "Items API",
  "version": "1.0.0"
}
```

#### GET /health/db
Проверка подключения к базе данных PostgreSQL.

**Ответ:** 
- `200 OK` - база данных доступна
  ```json
  {
    "status": "healthy",
    "database": "connected"
  }
  ```
- `503 Service Unavailable` - база данных недоступна

---

### CRUD эндпоинты для Items

### 1. GET /items
Получить список всех элементов с поддержкой пагинации и фильтрации.

**Query параметры:**
- `limit` (int, по умолчанию: 10) - максимальное количество элементов (от 1 до 100)
- `offset` (int, по умолчанию: 0) - смещение для пагинации
- `name` (str, опционально) - фильтр по имени элемента (частичное совпадение)

**Пример запроса:**
```
GET /items?limit=5&offset=0&name=test
```

**Ответ:** `200 OK` - список элементов

### 2. GET /items/{id}
Получить один элемент по ID.

**Ответ:** `200 OK` - данные элемента  
**Ошибка:** `404 Not Found` - элемент не найден

### 3. POST /items
Создать новый элемент.

**Тело запроса:**
```json
{
  "name": "Название элемента",
  "description": "Описание элемента (опционально)"
}
```

**Валидация:**
- `name` - обязательное поле, от 1 до 255 символов
- `description` - опциональное поле, максимум 1000 символов

**Ответ:** `201 Created` - созданный элемент  
**Ошибка:** `422 Unprocessable Entity` - некорректные данные (например, имя слишком длинное или пустое)

### 4. PUT /items/{id}
Обновить существующий элемент.

**Тело запроса:**
```json
{
  "name": "Новое название (опционально)",
  "description": "Новое описание (опционально)"
}
```

**Валидация:**
- `name` - опциональное поле, если указано - от 1 до 255 символов
- `description` - опциональное поле, максимум 1000 символов

**Ответ:** `200 OK` - обновленный элемент  
**Ошибки:** 
- `404 Not Found` - элемент не найден
- `422 Unprocessable Entity` - некорректные данные (например, имя слишком длинное)

### 5. DELETE /items/{id}
Удалить элемент по ID.

**Ответ:** `204 No Content` - успешное удаление  
**Ошибка:** `404 Not Found` - элемент не найден

## Быстрый старт

### Вариант 1: Запуск через Docker Compose (Рекомендуется)

Самый простой способ запуска проекта:

1. **Клонируйте репозиторий:**
   ```bash
   git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
   cd ITK_academy
   ```

2. **Запустите проект:**
   ```bash
   docker-compose up -d
   ```

3. **Проверьте работу:**
   - Откройте http://localhost:8000/docs в браузере
   - API должно быть доступно

**Управление:**
- Просмотр логов: `docker-compose logs -f`
- Остановка: `docker-compose down`
- Перезапуск: `docker-compose restart`

### Вариант 2: Запуск проекта локально

#### Требования
- Python 3.11 или выше
- pip

#### Шаги для запуска

1. **Клонируйте репозиторий:**
   ```bash
   git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
   cd ITK_academy
   ```

2. **Создайте виртуальное окружение:**

   **Linux/Mac:**
   ```bash
   python3 -m venv env
   source env/bin/activate
   ```

   **Windows:**
   ```bash
   python -m venv env
   env\Scripts\activate
   ```

3. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Запустите сервер:**
   ```bash
   uvicorn main:app --reload
   ```

   Сервер запустится на `http://localhost:8000`

   Для запуска на другом порту:
   ```bash
   uvicorn main:app --reload --port 8080
   ```

5. **Проверьте работу:**
   - Откройте http://localhost:8000/docs в браузере
   - Документация API должна быть доступна

## Проверка эндпоинтов через Swagger

После запуска сервера документация API доступна в интерактивном режиме:

### Swagger UI
Откройте в браузере: **http://localhost:8000/docs**

В Swagger UI вы можете:
- Просмотреть все доступные эндпоинты
- Увидеть схемы запросов и ответов
- Протестировать каждый эндпоинт прямо в браузере
- Отправить запросы с различными параметрами

**Как использовать Swagger UI:**

1. Откройте http://localhost:8000/docs в браузере
2. Выберите нужный эндпоинт (например, `POST /items`)
3. Нажмите кнопку "Try it out"
4. Заполните необходимые поля (для POST/PUT) или параметры (для GET)
5. Нажмите "Execute"
6. Просмотрите ответ сервера в разделе "Responses"

**Примеры тестирования:**

- **Создать элемент:**
  - Выберите `POST /items`
  - Нажмите "Try it out"
  - Введите JSON:
    ```json
    {
      "name": "Мой первый элемент",
      "description": "Это описание элемента"
    }
    ```
  - Нажмите "Execute"

- **Получить список элементов:**
  - Выберите `GET /items`
  - Нажмите "Try it out"
  - Установите параметры (limit, offset, name) при необходимости
  - Нажмите "Execute"

- **Получить элемент по ID:**
  - Выберите `GET /items/{item_id}`
  - Нажмите "Try it out"
  - Введите ID элемента (например, 1)
  - Нажмите "Execute"

### ReDoc
Альтернативная документация доступна по адресу: **http://localhost:8000/redoc**

## Тестирование через Postman

Для удобного тестирования API подготовлена полная коллекция Postman с автоматическими тестами.

### Импорт коллекции

1. **Откройте Postman**
2. **Импортируйте коллекцию:**
   - Нажмите `Import` в левом верхнем углу
   - Выберите файл `postman/Items_API.postman_collection.json`
   - Или перетащите файл в окно Postman
3. **Настройте переменные:**
   - Откройте коллекцию → вкладка `Variables`
   - Убедитесь, что `base_url` установлен в `http://localhost:8000`
   - При необходимости измените значение

### Структура коллекции

Коллекция включает **6 разделов** с **40+ тестовыми запросами**:

#### 1. Успешные сценарии (Happy Path)
- Создание элементов (с описанием и без)
- Получение всех элементов
- Получение элемента по ID
- Обновление элемента (полное и частичное)
- Удаление элемента

#### 2. GET /items - Пагинация и фильтрация
- Параметры `limit` и `offset`
- Фильтрация по имени (регистронезависимая)
- Комбинации параметров

#### 3. Валидационные ошибки (422)
- Пустое имя элемента
- Отсутствие обязательных полей
- Неправильные типы данных
- Некорректные параметры пагинации
- Некорректные ID (0, отрицательные, не числа)

#### 4. Ошибки 404 (Не найдено)
- Несуществующие элементы
- Обновление несуществующих элементов
- Удаление несуществующих элементов

#### 5. Граничные случаи
- Минимальные и максимальные значения параметров
- Длинные имена элементов
- Специальные символы в данных
- Эмодзи в данных
- Пустые тела запросов

#### 6. Производительность и нагрузка
- Проверка времени ответа
- Тесты производительности

### Запуск тестов

#### Запуск всей коллекции:
1. Откройте коллекцию `Items API - Расширенное тестирование`
2. Нажмите `Run` (кнопка справа от названия коллекции)
3. Выберите все запросы или нужные разделы
4. Нажмите `Run Items API...`
5. Просмотрите результаты тестов

#### Запуск отдельных запросов:
1. Выберите нужный запрос в коллекции
2. Нажмите `Send`
3. Просмотрите результаты в разделе `Test Results` (вкладка `Test Results`)

### Автоматические проверки

Каждый запрос содержит автоматические тесты (assertions), которые проверяют:
- Статус код ответа
- Наличие обязательных полей
- Корректность типов данных
- Соответствие значений ожидаемым
- Время выполнения запроса

### Переменные коллекции

Коллекция использует следующие переменные:
- `base_url` - базовый URL API (по умолчанию: `http://localhost:8000`)
- `created_item_id` - автоматически сохраняется после создания элемента для последующих тестов

## Запуск через Docker (без Compose)

Если вы предпочитаете использовать Docker напрямую без Compose:

### Требования
- Docker установлен на вашей системе

### Шаги для запуска

1. **Клонируйте репозиторий:**
   ```bash
   git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
   cd ITK_academy
   ```

2. **Соберите Docker образ:**
   ```bash
   docker build -t items-api .
   ```

3. **Запустите контейнер:**
   ```bash
   docker run -d -p 8000:8000 --name items-api-container items-api
   ```

   Или с автоматическим перезапуском:
   ```bash
   docker run -d -p 8000:8000 --name items-api-container --restart unless-stopped items-api
   ```

4. **Проверьте работу:**
   - Откройте http://localhost:8000/docs в браузере
   - API должно быть доступно

### Управление контейнером

- **Остановить контейнер:**
  ```bash
  docker stop items-api-container
  ```

- **Запустить контейнер:**
  ```bash
  docker start items-api-container
  ```

- **Просмотреть логи:**
  ```bash
  docker logs items-api-container
  ```

- **Удалить контейнер:**
  ```bash
  docker rm items-api-container
  ```

## Технические детали

- **База данных:** PostgreSQL 15 (данные сохраняются персистентно)
- **ORM:** SQLAlchemy 2.0 с асинхронной поддержкой
- **Валидация:** Автоматическая валидация данных через Pydantic
  - `name`: обязательное поле, от 1 до 255 символов
  - `description`: опциональное поле, максимум 1000 символов
- **Документация:** Автоматически генерируется FastAPI (Swagger/OpenAPI)
- **Обработка ошибок:** Стандартные HTTP коды (404, 422, 503)
- **Health Checks:** Эндпоинты для мониторинга состояния API и БД
- **Логирование:** Детальное логирование всех операций через Loguru

## Примеры использования через curl

### Health Check

**Проверка работоспособности API:**
```bash
curl "http://localhost:8000/health"
```

**Проверка подключения к базе данных:**
```bash
curl "http://localhost:8000/health/db"
```

### Создать элемент
```bash
curl -X POST "http://localhost:8000/items" \
  -H "Content-Type: application/json" \
  -d '{"name": "Test Item", "description": "Test Description"}'
```

### Получить список элементов
```bash
curl "http://localhost:8000/items?limit=10&offset=0"
```

### Получить элемент по ID
```bash
curl "http://localhost:8000/items/1"
```

### Обновить элемент
```bash
curl -X PUT "http://localhost:8000/items/1" \
  -H "Content-Type: application/json" \
  -d '{"name": "Updated Item", "description": "Updated Description"}'
```

### Удалить элемент
```bash
curl -X DELETE "http://localhost:8000/items/1"
```

